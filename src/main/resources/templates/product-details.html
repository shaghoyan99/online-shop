<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="#{page.product.details.title}"></title>
    <link rel="stylesheet" href="/style.css">
</head>
<body class="page">
<div th:replace="~{fragments/HeaderFragment :: headerFragment}"></div>

<main class="page-inner">
    <div class="section-head">
        <div>
            <h2 class="section-title" th:text="#{product.details.body.text.title}"></h2>
            <p class="section-subtitle" th:text="#{product.details.body.text.subtitle}"></p>
        </div>
    </div>

    <div class="detail-layout">
        <div class="detail-card">
            <img th:if="${product.pictureName != null}"
                 th:src="@{/image/get(photo=${product.pictureName})}"
                 alt="Product image">
            <img th:if="${product.pictureName == null}" src="/images/placeholder.jpg" alt="Product image">
        </div>
        <div class="detail-card">
            <h2 th:text="${product.title}"></h2>
            <p class="price" th:text="${'$' + product.price}"></p>
            <p class="section-subtitle" th:text="${product.createdAt}"></p>
            <p class="section-subtitle" th:text="${product.description}"></p>
        </div>
    </div>

    <section class="section">
        <div class="section-head">
            <div>
                <h2 class="section-title" th:text="#{product.details.body.comment.title}"></h2>
                <p class="section-subtitle" th:text="#{product.details.body.comment.subtitle}"></p>
            </div>
        </div>
        <div class="comment-list">
            <div class="comment-card" th:each="comment : ${product.comments}">
                <div>
                    <strong th:text="${comment.user != null ? comment.user.name + ':' : 'User:'}">User:</strong>
                    <span th:text="${comment.comment}">Comment text</span>
                </div>
                <form sec:authorize="hasAuthority('ADMIN')"
                      th:action="@{/comment/{id}/delete(id=${comment.id})}"
                      method="post">
                    <button type="submit" class="button-danger" th:text="#{product.details.body.comment.delete.button}"></button>
                </form>
                <form sec:authorize="hasAuthority('USER')"
                      th:if="${user != null && comment.user != null && user.id == comment.user.id}"
                      th:action="@{/comment/{id}/delete(id=${comment.id})}"
                      method="post">
                    <button type="submit" class="button-danger" th:text="#{product.details.body.comment.delete.button}"></button>
                </form>
            </div>
        </div>
        <form class="detail-card detail-form" action="/addComment" method="post" th:if="${user != null}">
            <input type="hidden" name="productId" th:value="${product.id}">
            <textarea name="comment" th:placeholder="#{product.details.body.comment.placeholder}"></textarea>
            <button type="submit" class="form-actions" th:text="#{product.details.body.comment.add.button}"></button>
        </form>
        <a class="section-subtitle" href="/login" th:if="${user == null}" th:text="#{product.details.body.login.href.comment}"></a>
    </section>
</main>
</body>
</html>
